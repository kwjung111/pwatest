var ae=Object.defineProperty,ne=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var _=(a,e,t)=>e in a?ae(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,j=(a,e)=>{for(var t in e||(e={}))oe.call(e,t)&&_(a,t,e[t]);if(q)for(var t of q(e))ie.call(e,t)&&_(a,t,e[t]);return a},z=(a,e)=>ne(a,se(e));var i=(a,e,t)=>(_(a,typeof e!="symbol"?e+"":e,t),t);var o;(s=>{let a;(l=>(l.Debug="debug",l.Info="info",l.Warn="warn",l.Error="error",l.Quiet="quiet"))(a=s.Level||(s.Level={}));let e=new Map([["debug",1],["info",2],["warn",3],["error",4],["quiet",5]]),t="debug";function r(u){t=u}s.setLevel=r;function n(u,...d){if(!(e.get(t)>e.get(u)))switch(u){case"debug":console.debug(...d);break;case"info":console.log(...d);break;case"warn":console.warn(...d);break;case"error":console.error(...d);break;default:break}}s.log=n})(o||(o={}));var K={"scandit-datacapture-sdk-barcode-simd":{bytes:5646813},"scandit-datacapture-sdk-barcode":{bytes:5470762},"scandit-datacapture-sdk-id":{bytes:6531597},"scandit-datacapture-sdk-id-simd":{bytes:6704790}};var W=K;function ue(a){return[...new Uint8Array(a)].map(e=>{let t=e.toString(16);return t.length===1?`0${t}`:t}).join("")}async function N(a,e,t){if(typeof crypto.subtle.digest!="function")return o.log(o.Level.Warn,`Insecure context (see https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts): The hash of the Scandit Data Capture library WASM file found at ${t} could not be verified`),"NOT_VERIFIABLE";try{let r=a instanceof Promise?await a:a,n=await crypto.subtle.digest("SHA-256",r),s=ue(n);return e==null?(o.log(o.Level.Warn,"The library hash is not defined or empty, cannot correctly verify integrity."),"NOT_VERIFIABLE"):s===e?(o.log(o.Level.Debug,"Data Capture library WASM integrity has been verified correctly."),"VALID"):(o.log(o.Level.Warn,`The Scandit Data Capture library WASM file found at ${t} seems invalid: expected file hash doesn't match (received: ${s}, expected: ${e}). Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`),"INVALID")}catch(r){return"NOT_VERIFIABLE"}}var B=new Map([["br",4.4],["gzip",2.9],["none",1]]);function le(a){var r;let e="content-encoding";if(a==null||a.get(e)==null)return B.get("none");let t=new Set(((r=a.get(e))!=null?r:"").split(",").map(n=>n.trim()));for(let[n,s]of B)if(t.has(n))return s;return B.get("none")}function ce(a){var r,n;if(a==null)return 0;let e=(r=le(a))!=null?r:1,t=Number.parseInt((n=a.get("content-length"))!=null?n:"0",10);return Number.isNaN(t)?0:Math.floor(t*e*100)/100}function pe(a){let{pathname:e}=new URL(a);return e.endsWith(`${"scandit-datacapture-sdk-id"}.wasm`)?W["scandit-datacapture-sdk-id"].bytes:e.endsWith(`${"scandit-datacapture-sdk-barcode"}.wasm`)?W["scandit-datacapture-sdk-barcode"].bytes:e.endsWith(`${"scandit-datacapture-sdk-barcode-simd"}.wasm`)?W["scandit-datacapture-sdk-barcode-simd"].bytes:e.endsWith(`${"scandit-datacapture-sdk-id-simd"}.wasm`)?W["scandit-datacapture-sdk-id-simd"].bytes:0}var me=(a,e)=>{let t=ce(e);return t===0?pe(a):t};function ge(a,e,{onProgress:t,onError:r,onComplete:n}){let{body:s,status:u,statusText:d,headers:f}=e.clone();if(!s)return e;let w=me(a,f),y=0,l=0,g=s.getReader(),C=new ReadableStream({async start(c){async function p(){try{let{done:b,value:h}=await g.read();if(b){c.close(),t==null||t({percentage:100,loadedBytes:y,privateUri:a}),n==null||n({percentage:100,loadedBytes:y,privateUri:a});return}y+=h.length,w>0&&h.length>0&&l<100?(l=Number((y/w*100).toFixed(2)),t==null||t({percentage:l,loadedBytes:y,privateUri:a})):w===0&&h.length>0&&(t==null||t({percentage:null,loadedBytes:y,privateUri:a})),c.enqueue(h),await p()}catch(b){throw r==null||r({error:b}),b}}return p()}});return new Response(C,{headers:new Headers(f),status:u,statusText:d})}async function V({wasmURI:a,awaitFullResponse:e,onProgress:t}){let r=await fetch(a);if(!r.ok)throw new Error(`HTTP status code is not ok: ${r.status}, ${r.statusText}`);return new Promise((n,s)=>{let u=ge(a,r,{onProgress:t,onError:({error:d})=>{s(d)},onComplete:()=>{e&&n(u)}});e||n(u)})}function J(a,e,t,r,n){async function s(d){try{let w=await(d!=null?d:await V({wasmURI:e,awaitFullResponse:!0,onProgress:n})).arrayBuffer();N(w,t,e);let y=await self.WebAssembly.instantiate(w,a);r(y.instance,y.module)}catch(f){o.log(o.Level.Error,f),o.log(o.Level.Error,`Couldn't instantiate Scandit SDK DataCapture library at ${e}, did you configure the path for it correctly?`)}}async function u(){let d;try{d=await V({wasmURI:e,awaitFullResponse:!1,onProgress:n}),N(d.clone().arrayBuffer(),t,e);let f=await self.WebAssembly.instantiateStreaming(d,a);r(f.instance,f.module);return}catch(f){o.log(o.Level.Warn,f),o.log(o.Level.Warn,"WebAssembly streaming compile failed. Falling back to ArrayBuffer instantiation (this will make things slower)"),s((d==null?void 0:d.bodyUsed)===!0?void 0:d)}}typeof self.WebAssembly.instantiateStreaming=="function"?u():s()}async function $(a,e,t,r){return new Promise((n,s)=>{a().then(n).catch(u=>{let d=e*2;if(d>t){s(u);return}r(u),self.setTimeout(()=>{$(a,d,t,r).then(n).catch(s)},e)})})}var A=class{constructor(){i(this,"promise");i(this,"resolve");i(this,"reject");this.promise=new Promise((e,t)=>{this.reject=t,this.resolve=e})}};var x=class extends Error{constructor(t){super(t.message);i(this,"name");i(this,"message");Object.setPrototypeOf(this,x.prototype),typeof t.name=="string"&&(this.name=t.name),typeof t.message=="string"&&(this.message=t.message)}};async function X(a){let e,{preloading:t,writableDataPathPreload:r,writableDataPath:n}=a,s=Promise.resolve(),u=!1,d=!1;async function f(){let l="FILE_DATA",g,C,c,p,b;function h(){clearTimeout(b),c.result.close(),p.result.close(),g(0)}function R(){try{let D=[],M=c.result.transaction(l,"readonly");M.addEventListener("error",h),M.addEventListener("abort",h);let P=M.objectStore(l).openCursor();P.onsuccess=()=>{let S=P.result;if(S==null)try{let m=0,v=p.result.transaction(l,"readwrite"),I=v.objectStore(l);v.addEventListener("error",h),v.addEventListener("abort",h),v.oncomplete=()=>{clearTimeout(b),c.result.close(),p.result.close(),g(m)};for(let k of D){let L=I.count(k.primaryKey);L.onsuccess=()=>{L.result===0&&(++m,I.add(k.value,k.primaryKey))},clearTimeout(b),b=self.setTimeout(()=>{o.log(o.Level.Warn,"IndexedDB database is blocked! Resetting Scandit Data Capture library..."),C(new x({name:"BlockedIndexedDB",message:"IndexedDB database is blocked"}))},500)}}catch(m){h.call({error:m})}else D.push({value:S.value,primaryKey:S.primaryKey.toString().replace(`${r}/`,`${n}/`)}),S.continue()},P.onerror=h}catch(D){h.call({error:D})}}return new Promise((D,M)=>{g=D,C=M,c=indexedDB.open(r),c.onupgradeneeded=()=>{try{c.result.createObjectStore(l)}catch(P){}},c.onsuccess=()=>{if(!Array.from(c.result.objectStoreNames).includes(l)){D(0);return}p=indexedDB.open(n),p.onupgradeneeded=()=>{try{p.result.createObjectStore(l)}catch(P){}},p.onsuccess=()=>{R()},p.onblocked=p.onerror=h},c.onblocked=c.onerror=h})}async function w(l,g){if(e!=null)return u=!0,new Promise((C,c)=>{(!t&&l?f():Promise.resolve(0)).then(p=>{if(!t&&l&&!g&&p===0){u=!1,C();return}e(l,b=>{if(u=!1,b!=null){c(b);return}C()})}).catch(c)})}async function y(l,g=!1,C=!1){return(!d||C)&&(u?(d=!0,s=s.then(async()=>(d=!1,w(l,g)))):s=w(l,g)),s}e=FS.syncfs,FS.syncfs=(l,g)=>{let C=g;g=c=>{C(c)},y(l).then(g).catch(g)};try{FS.mkdir(n)}catch(l){if(l.code!=="EEXIST")throw e=void 0,l}return FS.mount(IDBFS,{},n),y(!0,!0)}var F;(e=>{function a(){let t="6.17.1";if(t==null)throw new x({name:"Invalid library version",message:"Library version is not defined or empty."});return t}e.sdkVersion=a})(F||(F={}));function be(a){return/^https?:\/\/(?:[^./]*\.)*cdn.jsdelivr.net\//.test(a)?{result:!0,cdnBaseURL:"https://cdn.jsdelivr.net/npm/"}:/^https?:\/\/(?:[^./]*\.)*unpkg.com\//.test(a)?{result:!0,cdnBaseURL:"https://unpkg.com/"}:{result:!1,cdnBaseURL:""}}function ye(a){let t=/scandit-web-datacapture-[a-z]+/i.exec(a);return t?t[0]:null}function Y(a,e,t){let r=e,n=be(r);if(n.result){let u=ye(r);u!=null&&(r=`${n.cdnBaseURL}${u}@${a}/build/engine/`)}let s=t.replace(".wasm","");return n.result?{jsURI:`${r}${s}.js`,wasmURI:`${r}${s}.wasm`}:{jsURI:`${r}${s}.js?v=${a}`,wasmURI:`${r}${s}.wasm?v=${a}`}}function Q(){return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,1,253,15,253,98,11]))}var E=class{constructor(e,t){i(this,"lastUsedModuleMirrorAxis");i(this,"context");i(this,"MAX_NUMBER_OF_IMAGES_IN_FRAME_DATA_POOL",10);i(this,"libraryLoadingPromise");i(this,"writableDataPath");i(this,"resourcePath");i(this,"_isDrawLoopRunning",!1);i(this,"redrawInterval",1e3/30);i(this,"redrawRequests",[]);i(this,"loopTimeoutId");i(this,"contextDeserializer");i(this,"imageFrameSource");i(this,"view");i(this,"lastFrameCounter",-1);i(this,"frameDataPool",new Map);i(this,"moduleHandler");i(this,"workerFunctions");this.moduleHandler=e,this.workerFunctions=t,this._loadProgressCallback=this._loadProgressCallback.bind(this)}_loadProgressCallback(e){this.workerFunctions.postMessage({type:"loadLibraryProgress",payload:e})}get Module(){return this.moduleHandler.get()}loadLibrary(e){return this.libraryLoadingPromise!=null?this.libraryLoadingPromise:(this.libraryLoadingPromise=this.setup(e.libraryLocation,e.locationPath,e.preloadEngine,e.writableDataPathOverride),this.libraryLoadingPromise)}createContext(e){let t=this.getModeDeserializers();this.contextDeserializer=new this.Module.DataCaptureContextDeserializer(this.writableDataPath,e.deviceId,e.context.deviceModelName,e.domain,t,e.delayedRegistration,e.highEndBlurryRecognition,this.resourcePath);let r=this.contextDeserializer.contextFromJson(JSON.stringify(e.context)),n=r.getView();this.context=r.getContext();let s=this.Module.DataCaptureContextListener.extend("DataCaptureContextListener",{didChangeStatus:(d,f)=>{this.contextDidChangeStatus(JSON.parse(f.toJson()))},didStartObservingContext:()=>{this.didStartObservingContext()}}),u=new s;this.context.addListener(u),u.delete(),this.setView(n)}getModeDeserializers(){return new this.Module.VectorDataCaptureModeDeserializer}setFrameSource(e){var t;this.lastUsedModuleMirrorAxis=this.mapMirrorAxisOnModule(e),(t=this.imageFrameSource)==null||t.delete(),this.imageFrameSource=new this.Module.ImageBufferFrameSource(this.lastUsedModuleMirrorAxis),this.context.setFrameSource(this.imageFrameSource)}processFrame(e){var n;if(this.context==null)return{payload:e,transferables:[e.data.buffer]};let t=e.data,r=this.Module.allocateUint8Array(t.byteLength);return this.Module.HEAPU8.set(t,r),(n=this.imageFrameSource)==null||n.outputFrame(r,e.width,e.height,this.Module.ImageBufferFormat.Rgba8888),{payload:e,transferables:[e.data.buffer]}}updateContext(e){if(this.context!=null&&this.contextDeserializer!=null){let t=this.contextDeserializer.updateContextFromJson(this.context,this.view,JSON.stringify(e.context));this.context=t.getContext();let r=t.getView();r!=null&&e.view!=null&&r.setViewSize(e.view.width,e.view.height),this.setView(r),o.log(o.Level.Debug,"context updated",e)}}reportCameraProperties(e){this.context.setCameraProperties(e.deviceId,e.isFrontFacing,e.hasAutofocus)}dispose(){this.context.dispose()}extractCentaurusLicense(e){return{payload:{centaurus:{licenseKey:this.Module.LicenseUtils.getBlinkIdLicenseKey(e)}}}}convertToLoadableFrameData(e){let t=this.getNextFrameId();this.frameDataPool.set(t,new Uint8ClampedArray(e.getFrameData()));let r=this.lastUsedModuleMirrorAxis!=null?this.lastUsedModuleMirrorAxis!==this.Module.Axis.None:!1;return{frameId:t,width:e.getWidth(),height:e.getHeight(),isFrameSourceMirrored:r}}requestFrameData(e){let t=this.frameDataPool.get(e);return t==null?{payload:{data:null}}:{payload:{data:t},transferables:[t.buffer]}}deleteFrameData(e){this.frameDataPool.delete(e)}getNextFrameId(){return this.lastFrameCounter++,this.lastFrameCounter>=this.MAX_NUMBER_OF_IMAGES_IN_FRAME_DATA_POOL&&(this.lastFrameCounter=0),this.lastFrameCounter}setView(e){this.view=e,this.setViewRefreshHandler(e),e==null&&(this.isDrawLoopRunning=!1,this.sendViewRefreshCommands([]))}contextDidChangeStatus(e){var t,r;if(e.code===260){let n;if((t=location.href)!=null&&t.startsWith("blob:null/"))n="localhost";else{let s=((r=location.pathname)==null?void 0:r.length)>1&&!location.pathname.startsWith("/");n=new URL(s?location.pathname:location.origin).hostname}n.startsWith("[")&&n.endsWith("]")&&(n=n.slice(1,-1)),e.message=e.message.replace("domain name",`domain name (${n})`)}this.workerFunctions.postMessage({type:"contextDidChangeStatus",payload:e})}didStartObservingContext(){this.workerFunctions.postMessage({type:"didStartObservingContext"})}setViewRefreshHandler(e){if(e==null||e.isViewRefreshHandlerSet)return;let t=this.Module.NeedsRedrawDelegate.extend("NeedsRedrawDelegate",{setNeedsRedrawIn:this.scheduleRedraw.bind(this,e)}),r=new t;e.setNeedsRedrawDelegate(r),e.isViewRefreshHandlerSet=!0}scheduleRedraw(e,t){this.addRedrawRequest(t),this.isDrawLoopRunning||this.startDrawLoop(e)}get isDrawLoopRunning(){return this._isDrawLoopRunning}set isDrawLoopRunning(e){this._isDrawLoopRunning=e,!e&&typeof this.loopTimeoutId=="number"&&(clearTimeout(this.loopTimeoutId),this.loopTimeoutId=void 0)}addRedrawRequest(e){this.redrawRequests.push(Math.round(performance.now())+e),this.redrawRequests.sort((t,r)=>t-r)}startDrawLoop(e){this.isDrawLoopRunning=!0;let t=s=>this.redrawRequests.length>0&&this.redrawRequests[0]<=s,r=s=>{for(;this.redrawRequests.length>0&&this.redrawRequests[0]<=s;)this.redrawRequests.shift()},n=()=>{this.loopTimeoutId=setTimeout(()=>{if(!this.isDrawLoopRunning)return;let s=performance.now();t(s)&&(r(s),e.draw(),this.sendViewRefreshCommands(JSON.parse(e.getDrawCommands()))),n()},this.redrawInterval)};n()}sendViewRefreshCommands(e){this.workerFunctions.postMessage({type:"draw",payload:e})}getWasmDynamicLibraries(e){return this.getWasmSideModuleFileName()==null?[]:[`${e.replace(/\/[^/]*$/,"/")}${this.getWasmSideModuleFileName()}`]}getWasmCoreExpectedHash(e){return e?globalThis.SDC_WASM_CORE_SIMD_HASH:""}getWasmCoreFileName(e){return e?globalThis.SDC_WASM_CORE_SIMD_FILE_NAME:""}getWasmSideModuleFileName(){return""}async setup(e,t,r,n){var S;function s(){let m=this.moduleHandler.get(),v=m.DataDecoding.extend("DataDecoding",{decode(I,k){try{let L=JSON.parse(k),U=[];for(let O of L){let re=new TextDecoder(O.ianaName,{fatal:!0});U.push(re.decode(I.slice(O.startIndex,O.endIndex)))}return U.join("")}catch(L){return""}}});m.setDataDecoding(new v)}let u=!1,d=!1,f="/scandit_sync_folder_preload",w="/scandit_sync_folder",y="resources";r?this.writableDataPath=f:n!=null?(o.log(o.Level.Debug,`IndexedDB database name override in use to recover from blocked standard database: ${n}`),this.writableDataPath=n):this.writableDataPath=w,this.resourcePath=`${e}${y}/`,self.path=t;let{resolve:l,reject:g,promise:C}=new A,c=()=>{d&&u&&(s.apply(this),this.moduleHandler.get().callMain(),l())},p=F.sdkVersion();if(p==="")throw new x({name:"Invalid library version",message:"Library version is not defined or empty, cannot generate proper path to library files."});let b=Q(),h=Y(p,e,this.getWasmCoreFileName(b)),{jsURI:R}=h,{wasmURI:D}=h;this.moduleHandler.set({canvas:(S=this.workerFunctions.getOffscreenCanvas())!=null?S:{getContext:()=>null},instantiateWasm:(m,v)=>(J(m,D,this.getWasmCoreExpectedHash(b),v,this._loadProgressCallback),{}),dynamicLibraries:this.getWasmDynamicLibraries(D),locateFile:m=>e+m,noInitialRun:!0,preRun:[async()=>{try{await X({writableDataPathPreload:f,writableDataPath:this.writableDataPath,preloading:r})}catch(m){if(m.name==="BlockedIndexedDB"){g(m.toString());return}o.log(o.Level.Debug,"No IndexedDB support, some data will not be persisted:",m)}d=!0,c()}],onRuntimeInitialized:()=>{u=!0,c()}});async function M(m){var I;async function v(){return importScripts(m)}try{await $(v,250,4e3,L=>{o.log(o.Level.Warn,L),o.log(o.Level.Warn,`Couldn't retrieve Scandit Data Capture library at ${m}, retrying...`)});let k=(I=self.SDC_WASM_JS_VERSION)!=null?I:"undefined";return k!==p&&o.log(o.Level.Warn,`The Scandit Data Capture library JS file found at ${m} seems invalid: expected version doesn't match (received: ${k}, expected: ${p}). Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`),!0}catch(k){return o.log(o.Level.Error,k),!1}}return await M(R)||g(`Couldn't retrieve Scandit Data Capture library at ${R}, did you configure the path for it correctly?`),C}mapMirrorAxisOnModule(e){switch(e){case"None":return this.Module.Axis.None;case"X":return this.Module.Axis.X;case"Y":return this.Module.Axis.Y;default:return this.Module.Axis.None}}};function G(a){console.warn("Reached unexpected case")}function T(a){return typeof a=="object"&&a!=null}function Z(a){if(typeof a=="string")return a;if(T(a)){if(typeof a.message=="string")return a.message}else if(typeof(a==null?void 0:a.toString)=="function")return a.toString();return"unknow error"}var Ce="js/worker.js",ee=Ce,H=class{constructor(e,t){i(this,"dataCaptureInstance");i(this,"workerSelf");this.workerSelf=e,this.dataCaptureInstance=new E(t,{postMessage:this.postMessage.bind(this),getOffscreenCanvas:this.getOffscreenCanvas.bind(this)}),this.listenToMessages()}listenToMessages(){this.workerSelf.onmessage=this.onMessage.bind(this)}postMessage(e,t){this.workerSelf.postMessage(e,t!=null?t:[])}getOffscreenCanvas(){if(typeof this.workerSelf.OffscreenCanvas=="function")return new this.workerSelf.OffscreenCanvas(32,32)}hasPayload(e){return T(e)&&"payload"in e}hasTransferables(e){return T(e)&&Array.isArray(e.transferables)}async respondWith(e,t,r){let n=null,s;try{s=r(),s instanceof Promise&&(s=await s)}catch(d){s=void 0,n=Z(d)}let u={type:"workerTaskId",command:e,id:t,payload:this.hasPayload(s)?s.payload:void 0};n!=null&&(u.error=n),this.postMessage(u,this.hasTransferables(s)?s.transferables:[])}onMessage(e){switch(e.data.command){case"loadLibrary":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.loadLibrary({libraryLocation:t.libraryLocation,locationPath:t.locationPath,preloadEngine:t.preloadEngine,writableDataPathOverride:t.writableDataPathOverride}))}break;case"createContext":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.createContext({context:t.context,deviceId:t.deviceId,domain:t.domain,delayedRegistration:t.delayedRegistration,highEndBlurryRecognition:t.highEndBlurryRecognition}))}break;case"setFrameSource":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.setFrameSource(t.mirrorAxis))}break;case"processFrame":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.processFrame({data:t.data,width:t.width,height:t.height}))}break;case"requestFrameData":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.requestFrameData(t.frameId))}break;case"deleteFrameData":{let{data:t}=e;this.respondWith(t.command,t.id,()=>{this.dataCaptureInstance.deleteFrameData(t.frameId)})}break;case"updateContext":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.updateContext(t))}break;case"dispose":this.respondWith(e.data.command,e.data.id,()=>this.dataCaptureInstance.dispose());break;case"reportCameraProperties":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.reportCameraProperties(t))}break;case"setLogLevel":{let{data:t}=e;this.respondWith(t.command,t.id,()=>{o.setLevel(t.level)})}break;case"extractCentaurusLicense":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.extractCentaurusLicense(t.licenseKey))}break;default:return G(e.data),!1}return!0}},tt=new H(self,{get:()=>self.Module,set:a=>{self.Module=a}});var te=class{constructor(e,t,r){i(this,"_dataCaptureWorker");i(this,"libraryLocation");i(this,"isPreloadEngine");i(this,"workerCommandId",1);i(this,"workerTasks",new Map);i(this,"workerListeners",[]);i(this,"workerMessageListener");this.libraryLocation=e,this.isPreloadEngine=t,this.workerMessageListener=this.onWorkerMessage.bind(this),this.dataCaptureWorker.addEventListener("message",this.workerMessageListener),typeof r=="function"&&this.addWorkerListener(n=>{n.type==="loadLibraryProgress"&&r(n.payload)})}static async create(e){var r,n;let t=new this(e.libraryLocation,(r=e.preloadEngine)!=null?r:!1,e.loadProgressNotifier);return await t.workerCommand("setLogLevel",{level:(n=e.logLevel)!=null?n:o.Level.Debug}),await t.load(),t}async load(){var e;try{await this.workerCommand("loadLibrary",{libraryLocation:this.libraryLocation,locationPath:window.location.pathname,preloadEngine:this.isPreloadEngine,writableDataPathOverride:(e=localStorage.getItem("scanditWritableDataPathOverride"))!=null?e:void 0})}catch(t){if(t!=null&&typeof t=="object"&&typeof t.error=="string"&&t.error.includes("BlockedIndexedDB"))return await this.terminateDataCaptureWorker(!1),this.dataCaptureWorker.addEventListener("message",this.workerMessageListener),localStorage.setItem("scanditWritableDataPathOverride",`/scandit_sync_folder_${[...crypto.getRandomValues(new Uint32Array(2))].map(r=>r.toString(32)).join("")}`),this.load();throw t}}async workerCommand(e,t,r){return new Promise((n,s)=>{let u=this.workerCommandId++;this.workerTasks.set(u,{resolve:n,reject:s,command:e});let d=z(j({},t),{command:e,id:u});this.dataCaptureWorker.postMessage(d,r)})}get dataCaptureWorker(){var e;return(e=this._dataCaptureWorker)!=null||(this._dataCaptureWorker=new Worker(ee)),this._dataCaptureWorker}async terminateDataCaptureWorker(e=!0){var t,r;e&&await this.workerCommand("dispose",{}),(t=this._dataCaptureWorker)==null||t.removeEventListener("message",this.workerMessageListener),(r=this._dataCaptureWorker)==null||r.terminate(),this._dataCaptureWorker=void 0}addWorkerListener(e){this.workerListeners.push(e)}removeWorkerListener(e){!this.workerListeners.includes(e)||this.workerListeners.splice(this.workerListeners.indexOf(e),1)}onWorkerMessage(e){let t=e.data;if(t.type==="workerTaskId"&&typeof t.id=="number"){let{id:r}=t,n=this.workerTasks.get(r);t.error!=null?n==null||n.reject(t):n==null||n.resolve(t.payload),this.workerTasks.delete(r)}else for(let r of this.workerListeners)r(t)}};export{E as DataCaptureEngine,te as DataCaptureLoader,H as WorkerMain,tt as workerInstance};
//# sourceMappingURL=worker.js.map
